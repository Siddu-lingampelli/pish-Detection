# Mistral AI Integration Setup Guide

## Overview
This application uses Mistral AI to generate natural language explanations for phishing detection results. The AI provides detailed analysis of why a URL is classified as legitimate, suspicious, or phishing, along with personalized safety tips.

## Features
- **Natural Language Explanations**: Easy-to-understand analysis of detection results
- **Context-Aware Tips**: Safety recommendations tailored to the result type
- **Fallback Mode**: System works without API key (basic explanations provided)

## Getting Your Mistral API Key

### Step 1: Create a Mistral Account
1. Visit [https://console.mistral.ai/](https://console.mistral.ai/)
2. Click "Sign Up" or "Login" if you already have an account
3. Complete the registration process

### Step 2: Generate API Key
1. Once logged in, navigate to the API Keys section
2. Click "Create New API Key"
3. Give your key a descriptive name (e.g., "Phishing Detection App")
4. Copy the generated API key immediately (it won't be shown again)

### Step 3: Add API Key to Your Project
1. Open the `server/.env` file in your project
2. Find the line that says: `MISTRAL_API_KEY=your_mistral_api_key_here`
3. Replace `your_mistral_api_key_here` with your actual API key
4. Save the file

Example:
```
MISTRAL_API_KEY=sk_1a2b3c4d5e6f7g8h9i0j...
```

### Step 4: Restart Your Backend Server
1. Stop your backend server (Ctrl+C in the terminal)
2. Start it again: `npm start` (from the `server` directory)
3. You should see a log message confirming Mistral AI is enabled

## Testing the Integration

### Test Without API Key
Even without a Mistral API key, the system provides basic explanations:
- Generic analysis based on detection results
- Standard safety tips
- Attribution: "Generated by basic explanation service"

### Test With API Key
With a valid Mistral API key:
- Detailed, context-aware explanations
- Specific analysis of risk factors
- Advanced safety tips
- Attribution: "Generated by Mistral AI"

## Example Outputs

### Legitimate URL (with AI)
```
Analysis: This URL appears legitimate based on standard HTTP protocol, 
absence of suspicious keywords, and clean reputation from Google Safe 
Browsing. The domain structure follows normal patterns without obvious 
phishing indicators.

Safety Tips:
• Always verify the website's SSL certificate before entering sensitive data
• Bookmark frequently visited legitimate sites to avoid typosquatting
• Be cautious even with legitimate-looking URLs
```

### Phishing URL (with AI)
```
Analysis: This URL shows multiple red flags including suspicious keywords 
('login', 'verify'), no HTTPS encryption, and detection by Google Safe 
Browsing as a phishing site. The domain pattern mimics legitimate services 
to deceive users.

Safety Tips:
• DO NOT enter any personal information on this site
• Report this URL to your IT security team or relevant authorities
• Close the browser tab immediately
• Run a full antivirus scan if you interacted with this site
```

## API Usage and Costs

### Mistral AI Pricing
- **Free Tier**: Limited requests per month (check Mistral's current pricing)
- **Paid Plans**: Available for higher usage volumes
- **Model Used**: `mistral-tiny` (fast and cost-effective)

### Request Parameters
- Temperature: 0.3 (balanced between consistency and creativity)
- Max Tokens: 250 (concise explanations)
- Each scan generates one API call

### Rate Limits
The system includes automatic fallback to basic explanations if:
- API key is missing or invalid
- Rate limit is exceeded
- Network error occurs
- Mistral service is unavailable

## Troubleshooting

### Common Issues

#### 1. "Mistral AI not configured" in logs
**Problem**: API key not set or invalid
**Solution**: 
- Check `.env` file has correct `MISTRAL_API_KEY`
- Ensure no extra spaces or quotes around the key
- Verify key is active in Mistral console

#### 2. Still getting basic explanations with valid key
**Problem**: Server not restarted after adding key
**Solution**: 
- Stop backend server (Ctrl+C)
- Start again: `npm start`

#### 3. API errors in console
**Problem**: Rate limit exceeded or network issues
**Solution**: 
- Wait a few minutes and try again
- Check your Mistral account for quota status
- System will automatically use fallback explanations

#### 4. Explanations seem generic even with AI
**Problem**: Fallback mode activated due to errors
**Solution**: 
- Check server logs for specific error messages
- Verify API key has proper permissions
- Check Mistral service status

## Security Best Practices

### Protecting Your API Key
1. **Never commit `.env` to version control**
   - Already included in `.gitignore`
   
2. **Rotate keys periodically**
   - Generate new keys every 3-6 months
   
3. **Use environment variables in production**
   - Don't hardcode keys in source code
   
4. **Monitor usage**
   - Check Mistral console for unusual activity
   
5. **Limit key permissions**
   - Use read-only keys if available

## Advanced Configuration

### Customizing AI Behavior
Edit `server/services/mistralExplanationService.js`:

#### Change Model
```javascript
model: 'mistral-small',  // More powerful model
```

#### Adjust Temperature (0.0 - 1.0)
```javascript
temperature: 0.5,  // More creative responses
```

#### Increase Response Length
```javascript
max_tokens: 500,  // Longer explanations
```

### Customizing Prompts
Edit the `buildPrompt()` method to change how the AI analyzes URLs:

```javascript
buildPrompt(url, detectionResult) {
  return `You are a cybersecurity expert. Analyze this URL...
  
  [Add your custom instructions here]
  `;
}
```

## Monitoring and Logs

### Log Messages to Watch For
```
✅ Mistral AI initialized successfully
   - API key is valid and working

⚠️ Mistral API key not configured
   - Using fallback mode (normal if key not added)

❌ Error generating AI explanation: [error details]
   - Check error message for specific issue
```

## Support and Resources

### Mistral AI Resources
- Documentation: [https://docs.mistral.ai/](https://docs.mistral.ai/)
- API Reference: [https://docs.mistral.ai/api/](https://docs.mistral.ai/api/)
- Pricing: [https://mistral.ai/pricing/](https://mistral.ai/pricing/)
- Discord Community: [https://discord.com/invite/mistralai](https://discord.com/invite/mistralai)

### Project Resources
- Main README: `README.md`
- Quick Start: `QUICKSTART.md`
- API Examples: `API_EXAMPLES.md`

## FAQ

**Q: Is Mistral AI required for the app to work?**
A: No, the system provides basic explanations automatically if no API key is configured.

**Q: Can I use a different AI service?**
A: Yes, you can modify `mistralExplanationService.js` to integrate OpenAI, Claude, or other AI services.

**Q: How much will this cost?**
A: Mistral offers a free tier. Each URL scan = 1 API call. Check Mistral's pricing for your expected volume.

**Q: Will explanations be saved in the database?**
A: Yes, all scan results including AI explanations are stored in MongoDB for the history page.

**Q: Can I disable AI explanations temporarily?**
A: Yes, simply remove or comment out the `MISTRAL_API_KEY` in `.env` and restart the server.

---

**Need Help?** Check the main `README.md` or open an issue in the project repository.
